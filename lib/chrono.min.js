(function(){var e,t,n,r,i,s=[].slice;e=function(){function e(){var e,t,n;n=arguments[0],t=2<=arguments.length?s.call(arguments,1):[],this.settings=n!=null?n:{},this.handlers=t,e={precision:1e3,startFrom:0},this.settings&&typeof this.settings!="object"&&(this.settings={precision:this.toMilliseconds(n)}),n=r(e,n),this.reset(n),this}return e.prototype.start=function(){return this.ticking?this:(this.ticking=!0,this.__timer.start(),this.__callHandlers("start"),this)},e.prototype.stop=function(){return this.__timer.stop(),this.ticking=!1,this.__callHandlers("stop"),this},e.prototype.reset=function(e){var t,i,s,o,u,a=this;this.ticking&&this.stop();if(e){typeof e!="object"&&(e={startFrom:e}),u=["precision","startFrom"];for(s=0,o=u.length;s<o;s++)t=u[s],i=e[t],i&&typeof i!="number"&&(e[t]=this.toMilliseconds(i));this.settings=r(this.settings,e)}return this.__timer=new n(this.settings.precision,function(){return a.__tick()}),this.__ms=this.settings.startFrom,this.__time=void 0,this},e.prototype.bind=function(){var e,t,n,r,i;t=1<=arguments.length?s.call(arguments,0):[],i=[];for(n=0,r=t.length;n<r;n++)e=t[n],i.push(this.handlers.push(e));return i},e.prototype.unbind=function(){var e,t,n,r,i,o,u,a,f;n=1<=arguments.length?s.call(arguments,0):[];for(i=0,u=n.length;i<u;i++){t=n[i],f=this.handlers;for(r=o=0,a=f.length;o<a;r=++o)e=f[r],e===t&&this.handlers.splice(r,1)}return this},e.prototype.time=function(e){var t;return!e&&!!this.__time?this.__time:(t=this.__newDate(this.__ms),e&&(t=this.__applyDateChanges(t,e),this.__ms=t.getTime()),this.__time=this.__timeObject(t),this.__time)},e.prototype.toMilliseconds=function(e){var t;t=0;switch(typeof e){case"number":t=e;break;case"string":t=this.__stringToMilliseconds(e);break;case"object":t=this.__objectToMilliseconds(e);break;default:throw new Error("unknow format : "+e)}return Math.floor(t)},e.prototype.__tick=function(){return this.__time=void 0,this.__ms+=this.settings.precision,this.__callHandlers("tick"),this},e.prototype.__callHandlers=function(e){var t,n,r,i;i=this.handlers;for(n=0,r=i.length;n<r;n++)t=i[n],t(this.__ms,this,e);return this},e.prototype.__applyDateChanges=function(e,t){var n,r,i,s,o;i=/([+\-*\/]?)(\d+)(ms|[tsmh])\s?/g,r=[];while(n=i.exec(t))r.push(n);for(s=0,o=r.length;s<o;s++)n=r[s],e=this.__dateSingleChange(e,n);return e},e.prototype.__dateSingleChange=function(e,t){var n,r,i,s,o;s=t[0],r=t[1],o=t[2],i=t[3],o=parseInt(o),n=0;if(r!==void 0){switch(i){case"ms":n=e.getMilliseconds();break;case"s":n=e.getSeconds();break;case"m":n=e.getMinutes();break;case"h":n=e.getHours()}switch(r){case"+":n+=o;break;case"-":n-=o;break;case"*":n*=o;break;case"/":n/=o;break;case"":n=o}}switch(i){case"ms":e.setMilliseconds(n);break;case"s":e.setSeconds(n);break;case"m":e.setMinutes(n);break;case"h":e.setHours(n)}return e},e.prototype.__timeObject=function(e){var t;return t={ms:e.getMilliseconds(),s:e.getSeconds(),m:e.getMinutes(),h:e.getHours(),t:e.getTime()}},e.prototype.__newDate=function(e){return new t(e)},e.prototype.__objectToMilliseconds=function(e){var t;return t=0,typeof e.ms=="number"&&(t+=e.ms),typeof e.s=="number"&&(t+=e.s*1e3),typeof e.m=="number"&&(t+=e.m*6e4),typeof e.h=="number"&&(t+=e.h*36e5),t},e.prototype.__stringToMilliseconds=function(e){var t,n,r,i,s,o;n=/(\d+)(ms|[tsmh])\s?/g,t=0,i=[];while(r=n.exec(e))i.push(r);for(s=0,o=i.length;s<o;s++)r=i[s],t+=this.__subStringToMilliseconds(r);return t},e.prototype.__subStringToMilliseconds=function(e){var t,n,r,i;i=e[0],n=e[1],r=e[2],n=parseInt(n),t=0;switch(r){case"ms":t=n;break;case"s":t=n*1e3;break;case"m":t=n*6e4;break;case"h":t=n*36e5}return t},e}(),r=function(e,t){var n,r;for(n in t)r=t[n],r!==void 0&&(e[n]=r);return e},n=function(){function e(e,t){this.precision=e!=null?e:1e3,this.callback=t,this.started=!1,this}return e.prototype.start=function(){return this.__handle?this:(this.started=!0,this.__baseline=(new Date).getTime(),this.__setTimeout(),this)},e.prototype.stop=function(){return this.started=!1,clearTimeout(this.__handle),this.__handle=void 0,this},e.prototype.__setTimeout=function(){var e,t,n,r=this;return n=(new Date).getTime(),t=this.precision-n+this.__baseline,t<0&&(t=0),e=function(){return r.__setTimeout(),r.callback()},this.__handle=setTimeout(e,t),this.__baseline+=this.precision},e}(),t=function(){function e(e){this.__ms=e!=null?e:0,this}return e.prototype.getTime=function(){return this.__ms},e.prototype.getMilliseconds=function(){return this.__ms%1e3},e.prototype.getSeconds=function(){return Math.floor(this.__ms/1e3)%60},e.prototype.getMinutes=function(){return Math.floor(this.__ms/6e4)%60},e.prototype.getHours=function(){return Math.floor(this.__ms/36e5)},e.prototype.setTime=function(e){return this.__ms=e,this.__ms},e.prototype.setMilliseconds=function(e){return this.__ms=this.__ms-this.getMilliseconds()+e},e.prototype.setSeconds=function(e){var t;return t=(e-this.getSeconds())*1e3,this.__ms=this.__ms+t},e.prototype.setMinutes=function(e){var t;return t=(e-this.getMinutes())*6e4,this.__ms=this.__ms+t},e.prototype.setHours=function(e){var t;return t=(e-this.getHours())*36e5,this.__ms=this.__ms+t},e}(),i=typeof exports!="undefined"&&exports!==null?exports:this,i.Chrono=e,i.Timer=n}).call(this);